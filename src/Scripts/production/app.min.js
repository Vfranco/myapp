"use strict";app.controller("analitica",["$scope",function(e){}]),app.controller("configuracion",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("dispositivos",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("empresas",["$scope","$http","Form","$timeout","Core","$window","$location","$document",function(r,l,o,i,d,n,a,e){r.dataEmpresas=[],r.loadDataEmpresas=!1,r.emptyStatus=!1,r.showCreateForm=!1,r.uid=uid,r.setMessage=!1,r.typeMessage="",r.messageText="",r.searchEmpleado="",r.showEditForm=!1,r.showDetailsEmpleado=!1,r.triggerSearch=!1,r.result=[],r.messageConfirm=!1,r.idEmpleado=0,r.customReport=!1,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.keepRegistering=!1,r.sede="",r.dataSedes=[],r.deleteSuccessSede=!1,r.showFormEditaSede=!0,r.showPlanes=!1,r.tiporegistro=1,l.post(baseurl+"empresas/readbyuser",{uid:uid}).then(function(e){if(e.data.status)for(var a in r.dataEmpresas=e.data.rows,r.dataEmpresas)r.dataEmpresas[a].estado&&(r.emptyStatus=!0);r.loadDataEmpresas=!0}),r.dataEmpleados=[],r.loadDataEmpleados=!1,r.messageEmpleados="",r.seeDetails=0,r.readEmpleados=function(){var e=l.post(baseurl+"empleados/readbyempresa",{uid:uid});r.messageEmpleados="Verificando ...",e.then(function(e){e.data.status?(r.loadDataEmpleados=!0,r.dataEmpleados=e.data.rows,r.messageEmpleados=""):(r.loadDataEmpleados=!1,r.messageEmpleados="No encontramos empleados")})},r.readEmpleados(),r.startToSearch=!1,r.$watch("result",function(e,a){e.length!=a.length&&e.length==a.length&&console.log("call")}),r.showDetails=function(e){r.showCreateForm=!1,r.showPlanes=!1,r.seeDetails=e},r.enableDetails=!1,r.requestDetails=function(e){r.idEmpleado=e,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showPlanes=!1,l.post(baseurl+"empleados/readbyid",{id_cms_empleado:e}).then(function(e){e.data.status&&(r.nombresApellidos=e.data.rows[0].nombres_personal+" "+e.data.rows[0].apellidos_personal,r.direccion=e.data.rows[0].direccion_personal,r.telefono=e.data.rows[0].telefono_personal,r.correo=e.data.rows[0].correo_personal,r.email=e.data.rows[0].correo_personal,r.photo=e.data.rows[0].photo_personal,r.enableDetails=!0,r.uid=e.data.rows[0].id_sg_personal,r.sede=e.data.rows[0].id_sg_sede.toString(),r.nombresede=e.data.rows[0].nombre_sede,r.cedula=e.data.rows[0].cedula_personal,r.nombres=e.data.rows[0].nombres_personal,r.apellidos=e.data.rows[0].apellidos_personal,r.direccion=e.data.rows[0].direccion_personal,r.telefono=e.data.rows[0].telefono_personal,r.correo=e.data.rows[0].correo_personal,r.estado=e.data.rows[0].id_sg_estado,r.showDetailsEmpleado=!1,r.showEditForm=!1)}),r.requestActividades(e)},r.dataResumenActividades=[],r.requestActividades=function(e){l.post(baseurl+"registros/obtenervisitas",{id_cms_empleado:e}).then(function(e){e.data.status?r.dataResumenActividades=e.data.rows:r.dataResumenActividades=[]})},r.cancelDetail=function(){r.uid=uid,r.enableDetails=!1,r.idEmpleado=0,o.resetForm("#frm-edita-empleado")},r.addEmpleado=function(){r.email="",r.uid=uid,r.keepRegistering=!1,r.showDetailsEmpleado=!0,r.showEditForm=!1,r.showCreateForm=!0,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showCreaDataSedes=!0,r.showPlanes=!1},r.editEmpleado=function(){r.showDetailsEmpleado=!0,r.enableDetails=!1,r.showEditForm=!0,r.keepRegistering=!1,r.showPlanes=!1},r.comebackToDetails=function(){r.uid=uid,r.showDetailsEmpleado=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showPlanes=!1,o.resetForm("#frm-edita-empleado")},r.btnRegistraEmpleado=!0,r.btnActualizaEmpleado=!1,r.email="",r.checkEmail=function(){r.btnRegistraEmpleado=!0,r.email.match(/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/)?(r.btnActualizaEmpleado=!1,r.btnRegistraEmpleado=!1):(r.btnRegistraEmpleado=!0,r.btnActualizaEmpleado=!0)},r.createEmpleado=function(){var e=o.OnSubmitForm({form:"#frm-create-empleado",css:".required",route:baseurl+"empleados/create",fields:"",clear:!1});1==e?(r.setMessage=!0,r.typeMessage="danger",r.messageText="Por favor, Ingrese los Datos",i(function(){r.setMessage=!1},2500)):e.then(function(e){e.data.status?(r.setMessage=!0,r.typeMessage="success",r.messageText="Has registrado tu empleado!",r.readEmpleados(),r.keepRegistering=!0,t(".comboBoxEmpleados",e.data.append.id,e.data.append.prop),o.resetForm("#frm-create-empleado"),i(function(){r.setMessage=!1})):(r.setMessage=!0,r.typeMessage="danger",r.messageText=e.data.message,i(function(){r.setMessage=!1},2500))})},r.done=function(){r.setMessage=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showDetailsEmpleado=!1,r.keepRegistering=!1,r.showPlanes=!1},r.another=function(){r.uid=uid,r.keepRegistering=!1,r.showDetailsEmpleado=!0,r.showEditForm=!1,r.showCreateForm=!0,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.setMessage=!1,r.showPlanes=!1},r.editaEmpleado=function(){var e=o.OnSubmitForm({form:"#frm-edita-empleado",css:".required",route:baseurl+"empleados/update",fields:"",clear:!1});1==e?(r.setMessage=!0,r.typeMessage="danger",r.messageText="Por favor, Ingrese los Datos",i(function(){r.setMessage=!1},2500)):e.then(function(e){e.data.status?(r.setMessage=!0,r.typeMessage="success",r.messageText=e.data.message,r.readEmpleados(),r.keepRegistering=!0,i(function(){r.setMessage=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showDetailsEmpleado=!1,r.enableDetails=!1},2500)):(r.setMessage=!0,r.typeMessage="danger",r.messageText=e.data.message,i(function(){r.setMessage=!1},2500))})},r.activateEmpleado=function(e,a){"1"==e?(l.post(baseurl+"empleados/disable",{id_cms_empleado:a,state:"2"}).then(function(e){e.data.status&&r.readEmpleados()}),r.estado="2"):(l.post(baseurl+"empleados/disable",{id_cms_empleado:a,state:"1"}).then(function(e){e.data.status&&r.readEmpleados()}),r.estado="1")},r.showListEmpleados=!1,r.dataVisitasEmpleado=[],r.reporteVisitasSedes=[],r.seeDetailsInOut=function(){r.showDetailsActivitys=!0,r.showListEmpleados=!0,r.showDetailsEmpleado=!0,r.showResumeEmpleados=!1,r.customReportInOut=!0,r.customReport=!0,r.showCreateForm=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showEditForm=!1,r.cedulaCheck=!0,r.nombresCheck=!0,r.apellidosCheck=!0,r.sedeCheck=!0,r.entradaCheck=!0,r.salidaCheck=!0,r.showPlanes=!1,l.post(baseurl+"registros/obtenervisitas",{id_cms_empresa:uid}).then(function(e){e.data.status&&(r.dataVisitasEmpleado=e.data.rows)});var e=l.post(baseurl+"reportes/reporteporsedes",{id_cms_empresa:uid}),s=[],t=[];e.then(function(e){if(e.data.status){r.reporteVisitasSedes=e.data.rows;for(var a in r.reporteVisitasSedes)s.push(r.reporteVisitasSedes[a].sede),t.push(parseInt(r.reporteVisitasSedes[a].visitas));c(s,t),u(s,t),m(s,t)}else r.reporteVisitasSedes=[]})};var c=function(e,a){var s=$("#chart-bars"),t=new Chart(s,{type:"bar",data:{labels:e,datasets:[{label:"Visitas",data:a}]}});s.data("chart",t)},u=function(e,a){var s=$("#chart-lines"),t=new Chart(s,{type:"line",options:{scales:{yAxes:[{gridLines:{color:Charts.colors.gray[200],zeroLineColor:Charts.colors.gray[200]},ticks:{}}]}},data:{labels:e,datasets:[{label:"Performance",data:a}]}});s.data("chart",t)},m=function(e,a){var s=$("#chart-pie"),t=new Chart(s,{type:"pie",data:{labels:e,datasets:[{data:a,backgroundColor:[Charts.colors.theme.danger,Charts.colors.theme.warning,Charts.colors.theme.success,Charts.colors.theme.primary,Charts.colors.theme.info],label:"Dataset 1"}]},options:{responsive:!0,legend:{position:"top"},animation:{animateScale:!0,animateRotate:!0}}});s.data("chart",t)};r.closeShowGraphics=function(){r.showGraphics=!1,r.showPlanes=!1},r.closeDetailsInOut=function(){r.showListEmpleados=!1,r.showDetailsEmpleado=!1,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.customReport=!1,r.showPlanes=!1,r.showDetailsActivitys=!1},r.selectedId,r.selectItem=function(e){r.selectedId=e},r.deleteSuccess=!1,r.reloadingEmpleados="",r.deleteProcessEmpleado=function(e,a,s){var t=l.post(baseurl+"empleados/delete",{id_cms_empleado:e}),o=a+" "+s;r.deleteSuccess=!0,r.reloadingEmpleados="Actualizando ...",t.then(function(e){e.data.status&&(r.readEmpleados(),r.reloadingEmpleados="Empleado Eliminado",p(".comboBoxEmpleados",o),r.enableDetails=!1,i(function(){r.deleteSuccess=!1},2500))})},r.cancelProcess=function(e){r.selectedId=""},r.customeReport=function(){r.customReport=!0,r.customReportInOut=!0,r.showPlanes=!1},r.closeCustomReport=function(){r.customReport=!1,r.customReportInOut=!1,r.showPlanes=!1},r.dataDetalleEmpleados=[],r.loadDetalleEmpleados=!1,r.verMisEmpleados=function(){r.loadDetalleEmpleados=!0,r.showDetailsEmpleado=!0,r.showResumeEmpleados=!0,r.customReport=!1,r.customReportInOut=!0,r.showListEmpleados=!1,r.dataDetalleEmpleados=[],r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showCreateForm=!1,r.showPlanes=!1,r.showDetailsActivitys=!1,l.post(baseurl+"empleados/readbyempresa",{uid:uid}).then(function(e){e.data.status?r.dataDetalleEmpleados=e.data.rows:r.dataDetalleEmpleados=[],r.loadDetalleEmpleados=!1})},r.setScroll=function(e){if(5<e.length)return"setScroll"},r.increase=0,r.createdEmpresa=!1,r.showBackMessage=!1,r.modulo="",r.recoveryStep=function(){var e=n.localStorage.getItem("paso");if(d.isEmpty(e))r.increase=0;else{var a=JSON.parse(e);r.increase=a.paso,r.modulo=a.modulo,r.showBackMessage=a.left,r.tipoRegistroSigga=a.tipo}},r.next=function(e,a){switch(r.modulo=e,r.tipoRegistroSigga=a,e){case"mipersonal":r.increase++;var s=n.localStorage.getItem("paso");if(null==(t=JSON.parse(s))){var t={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:1,entrypoint:"#!/empresas",user:uid})}else if(t.executed)t={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};n.localStorage.setItem("paso",JSON.stringify(t));break;case"visitantes":r.increase++;s=n.localStorage.getItem("paso");if(null==(t=JSON.parse(s))){t={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:2,entrypoint:"#!/visitantes",user:uid,control:1})}else if(t.executed)switch(a){case"residencial":t={paso:r.increase,modulo:e,left:!0,executed:!0,tipo:a,uid:r.uid};r.updateTipoControl({user:uid,control:1});break;case"empresa":t={paso:r.increase,modulo:e,left:!0,executed:!0,tipo:a,uid:r.uid};r.updateTipoControl({user:uid,control:2})}n.localStorage.setItem("paso",JSON.stringify(t));break;case"proveedores":r.increase++;t={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:2,entrypoint:"#!/proveedores",user:uid,control:2,uid:r.uid}),n.localStorage.setItem("paso",JSON.stringify(t))}},r.updateTipoRegistro=function(e){l.post(baseurl+"usuarios/updatetiporegistro",e).then(function(e){if(e.data.status)return!0})},r.updateTipoControl=function(e){l.post(baseurl+"usuarios/updatetipocontrol",e).then(function(e){if(e.data.status)return!0})},r.prev=function(){r.increase--;var e={paso:r.increase,left:!0};n.localStorage.setItem("paso",e)},r.recoveryStep(),r.errorMessageEmpresa="",r.errorMessageUnidad="",r.errorCreated=!1,r.createUnidad=!1,r.createUnidadResidencial=function(){var e=o.OnSubmitForm({form:"#frm-create-unidad",css:".required",route:baseurl+"unidad/create",fields:"",clear:!1});1==e?(r.errorMessageUnidad="Por favor, Ingresa los datos de tu empresa",r.errorCreated=!0):e.then(function(e){e.data.status?(r.createdUnidad=!0,o.resetForm("#frm-create-unidad")):(r.errorMessageUnidad="Ocurrio algo!, no hemos podido crear tu Unidad, porfavor intentalo de nuevo",r.errorCreated=!0)})},r.createempresa=function(){var e=o.OnSubmitForm({form:"#frm-create-empresa",css:".required",route:baseurl+"empresas/create",fields:"",clear:!1});1==e?(r.errorMessageEmpresa="Por favor, Ingresa los datos de tu empresa",r.errorCreated=!0):e.then(function(e){e.data.status?(r.createdEmpresa=!0,o.resetForm("#frm-create-empresas")):(r.errorMessageEmpresa=e.data.message,r.errorCreated=!0)})},r.errorMessageEmpresaVisitante="",r.errorCreatedEmpresaVisitante=!1,r.createEmpresaVisitante=function(){var e=o.OnSubmitForm({form:"#frm-create-empresa-visitante",css:".required",route:baseurl+"empresas/create",fields:"",clear:!1});1==e?(r.errorMessageEmpresaVisitante="Por favor, Ingresa los datos de tu empresa",r.errorCreatedEmpresaVisitante=!0):e.then(function(e){e.data.status?(r.errorCreatedEmpresaVisitante=!0,o.resetForm("#frm-create-empresa-visitante")):(r.errorMessageEmpresaVisitante=e.data.message,r.errorCreatedEmpresaVisitante=!0)})},r.btnUpdateEmpresa="Actualiza mi Empresa",r.editaempresa=function(){r.btnUpdateEmpresa="Actualizando...";var e=o.OnSubmitForm({form:"#frm-edita-empresa",css:".required",route:baseurl+"empresas/update",fields:"",clear:!1});1==e?(r.errorMessageEmpresa="Por favor, Ingresa los datos de tu empresa",r.typeMessage="danger",r.errorCreated=!0):(e.then(function(e){e.data.status?(r.errorCreated=!0,r.errorMessageEmpresa=e.data.message,r.typeMessage="success"):(r.errorMessageEmpresa=e.data.message,r.errorCreated=!0,r.typeMessage="danger")}),r.btnUpdateEmpresa="Actualiza mi Empresa")},r.errorMessageSede="",r.errorCreatedSede=!1,r.createdSede=!1,r.createSede=function(){var e=o.OnSubmitForm({form:"#frm-create-sede",css:".required",route:baseurl+"sedes/create",fields:"",clear:!1});1==e?(r.errorMessageSede="Por favor, Ingresa los datos de tu sede",r.errorCreatedSede=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0,r.createdSede=!0,o.resetForm("#frm-create-sede")):(r.typeMessage="danger",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0),r.getDataSedes(uid,e.data.status)})},r.errorMessageSedeVisitante="",r.errorCreatedSedeVisitante=!1,r.createSedeVisitante=function(){var e=o.OnSubmitForm({form:"#frm-create-sede-visitante",css:".required",route:baseurl+"sedes/create",fields:"",clear:!1});1==e?(r.errorMessageSedeVisitante="Por favor, ingrese los datos",r.errorCreatedSedeVisitante=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSedeVisitante=e.data.message,r.errorCreatedSedeVisitante=!0,r.createdSedeVisitante=!0,o.resetForm("#frm-create-sede")):(r.typeMessage="danger",r.errorMessageSedeVisitante=e.data.message,r.errorCreatedSedeVisitante=!0),r.getDataSedes(uid,e.data.status)})},r.getInSigga=function(){var e=n.localStorage.getItem("paso");switch(JSON.parse(e).modulo){case"mipersonal":n.location.reload(),n.localStorage.removeItem("paso"),location.reload();break;case"visitantes":a.path("/visitantes"),n.localStorage.removeItem("paso"),location.reload();break;case"proveedores":a.path("/proveedores"),n.localStorage.removeItem("paso")}},r.goToSection=function(){a.hash("detalles"),$anchorScroll()},r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.loadDataSedes=!1,r.messageSedes="",r.searchSedes="",r.editarEmpresa=function(){r.showEditaDataEmpresa=!1,r.showDetailsActivitys=!1,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showEditaDataSedes=!0,r.showResumeEmpleados=!1,r.showListEmpleados=!1,r.customReportInOut=!0,r.customReport=!1,r.showEditForm=!1,r.showCreateForm=!1,r.showPlanes=!1,l.post(baseurl+"empresas/readbyid",{id_cms_empresas:uid}).then(function(e){e.data.status&&(r.idEmpresa=e.data.rows[0].id_sg_empresa,r.empresa=e.data.rows[0].empresa,r.nit=e.data.rows[0].nit,r.correo=e.data.rows[0].email,r.direccion=e.data.rows[0].direccion,r.estado=e.data.rows[0].estado)})},r.editarSede=function(){r.showDetailsActivitys=!1,r.showEditaDataSedes=!1,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showResumeEmpleados=!1,r.showListEmpleados=!1,r.customReportInOut=!0,r.customReport=!1,r.showEditForm=!1,r.showCreateForm=!1,r.showPlanes=!1,r.getDataSedes(uid,!1)},r.closeSede=function(){r.showEditaDataEmpresa=!0,r.showDetailsEmpleado=!1,r.customReportInOut=!1,r.showEditaDataSedes=!0,r.errorCreated=!1,r.showPlanes=!1},r.closeEditEmpresa=function(){r.showEditaDataEmpresa=!0,r.showDetailsEmpleado=!1,r.customReportInOut=!1,r.showEditaDataSedes=!0,r.errorCreated=!1,r.showPlanes=!1},r.getDataSedes=function(e,a){l.post(baseurl+"sedes/readbyidempresa",{idusuario:e}).then(function(e){e.data.status&&(r.dataSedes=e.data.rows,a&&(t(".comboBoxSedes",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede),t(".comboBoxSedeEdit",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede),t(".comboBoxSedesCreate",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede)))})},r.showCreaDataSedes=!0,r.addSede=function(){r.showCreaDataSedes=!1,r.showEditaDataSedes=!0,r.errorCreatedSede=!1,r.showPlanes=!1},r.cancelAddSede=function(){r.showCreaDataSedes=!0,r.showEditaDataSedes=!1,r.createdSede=!1,r.showFormEditaSede=!0,r.showPlanes=!1},r.doneSede=function(){r.errorCreatedSede=!0,r.cancelAddSede()},r.anotherSede=function(){r.errorCreatedSede=!1,r.errorMessageSede="",r.createdSede=!1,r.addSede()},r.editSede=function(e){r.showEditaDataSedes=!0,r.showFormEditaSede=!1,r.errorCreatedSede=!1,r.showPlanes=!1,l.post(baseurl+"sedes/readbyid",{id_cms_sede:e}).then(function(e){e.data.status&&(o.resetForm("#frm-edita-sede"),r.idSede=e.data.rows[0].id_sg_sede,r.nombreSede=e.data.rows[0].nombre_sede,r.dirSede=e.data.rows[0].direccion_sede,r.telefonoSede=e.data.rows[0].telefono_sede)})},r.editProcessData=function(){var e=o.OnSubmitForm({form:"#frm-edita-sede",css:".required",route:baseurl+"sedes/update",fields:"",clear:!1});1==e?(r.errorMessageSede="Por favor, Ingresa los datos de tu sede",r.errorCreatedSede=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0,r.createdSede=!0,r.readEmpleados()):(r.typeMessage="danger",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0),r.getDataSedes(uid)})},r.deleteProcessSede=function(a){var e=l.post(baseurl+"sedes/delete",{id_cms_sede:a});r.deleteSuccessSede=!0,r.reloadingSede="Actualizando ...",r.typeMessage="info",e.then(function(e){e.data.status?(r.getDataSedes(uid),r.reloadingSede="Sede Eliminada",r.enableDetails=!1,r.selectedId="",r.typeMessage="success",s(".comboBoxSedes",a),s(".comboBoxSedesCreate",a),i(function(){r.deleteSuccessSede=!1},2500)):(r.reloadingSede=e.data.message,r.enableDetails=!1,r.selectedId="",r.typeMessage="danger",i(function(){r.deleteSuccessSede=!1},4e3))})};var s=function(e,a){$(e+' option[value="'+a+'"]').each(function(){$(this).remove()})},p=function(e,a){$(e+" option").each(function(){$(this).text()===a&&$(this).remove()})},t=function(e,a,s){$(e).append('<option value="'+a+'">'+s+"</option>")};r.arguments=[],r.cedulaCheck=!0,r.nombresCheck=!0,r.apellidosCheck=!0,r.sedeCheck=!0,r.entradaCheck=!0,r.salidaCheck=!0,r.sedeOption="",r.fechaDesde="",r.fechaHasta="",r.entradaSalidaOption="",r.empleadoOption="",r.showMessageErrorReporte=!1,r.generateReporte=function(){var e=o.serializeForm('#frm-generate-report input[type="checkbox"]');if(r.arguments=[],d.isEmpty(r.sedeOption)||d.isEmpty(r.fechaDesde)||d.isEmpty(r.fechaHasta)||d.isEmpty(r.entradaSalidaOption))r.showMessageErrorReporte=!0;else{for(var a in r.showMessageErrorReporte=!1,e)"on"==e[a]&&r.arguments.push(a);if(d.isEmpty(r.empleadoOption))s={fields:r.arguments.join(", "),id_cms_empresa:uid,desde:f(r.fechaDesde),hasta:f(r.fechaHasta),sede:r.sedeOption,entradaSalida:r.entradaSalidaOption};else var s={fields:r.arguments.join(", "),id_cms_empresa:uid,desde:f(r.fechaDesde),hasta:f(r.fechaHasta),sede:r.sedeOption,entradaSalida:r.entradaSalidaOption,empleado:r.empleadoOption};var t=l.post(baseurl+"registros/obtenerreporteactividades",s);r.dataVisitasEmpleado=[],t.then(function(e){e.data.status?r.dataVisitasEmpleado=e.data.rows:r.dataVisitasEmpleado=[]})}};var f=function(e){var a=new Date(e);return a.getFullYear()+"-"+g(a.getMonth()+1)+"-"+g(a.getDate())},g=function(e){return e<10?"0"+e:e};r.exportToExcel=function(e,a,s){for(var t=l.post(baseurl+e,s),o=$(a),r=[],i=0;i<o.length;i++){var d=o[i];r.push(d.textContent)}var n=[],c=[];n.push(r),t.then(function(e){e.data.status&&$.each(e.data.rows,function(e,a){c=[],$.each(a,function(e,a){c.push(a)}),n.push(c)}),n.push(c);var a=XLSX.utils.book_new(),s=XLSX.utils.aoa_to_sheet(n);XLSX.utils.book_append_sheet(a,s,"Sigga_Mi_Personal"),XLSX.writeFile(a,"Reporte_Mi_Personal.xlsx")})},r.generateReportPDF=function(){},r.showGraphics=!1,r.showResumeGraphics=function(){r.showGraphics=!0},r.showPlanesData=function(){r.showPlanes=!0,r.showListEmpleados=!0,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showDetailsActivitys=!1,r.customReport=!1},$(".tooltip-message").tooltip()}]),app.controller("personal",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("reportes",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("usuarios",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("visitantes",["$scope","$http","rx","Form","$timeout",function(s,t,e,a,o){var r="1"==tipocontrol?"apartamentos/":"oficinas/";s.uid=uid,s.dataResource=[],s.loadDataResource=!1,s.searchResource="",s.selectedIdResource="",s.cedula=0,s.telefono=0,s.showCreateForm=!1,s.seeDetails=0,s.resultResource=!1,s.panelTorre=!1,s.enableFormTorre=!1,s.muestraMensajeCarga="No hay datos que mostrar",s.idOficina=0,s.searchEmpleado="",s.searchTorre="",s.searchIntegrante="",t.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(s.dataResource=e.data.rows,s.loadDataResource=!0):s.loadDataResource=!1}),s.openTorre=function(){s.panelTorre=!0,s.ocultaDetalleOficina=!0,s.enableFormTorre=!1,s.ocultaDetalleOficina=!0,s.ocultaFormCreacionOficina=!1,s.integrantesOficina=[]},s.item="",s.piso="",s.disableInputs=!1,s.changeFormTorre=function(){"N/A"==$("#idTorre option:selected").text()?(s.piso="N/A",s.disableInputs=!0):(s.piso="",s.disableInputs=!1,2==s.item?s.enableFormTorre=!0:s.enableFormTorre=!1)},s.closeTorre=function(){s.panelTorre=!1,s.ocultaDetalleOficina=!1},s.cancelAddTorre=function(){s.enableFormTorre=!1,s.item=""},s.createdTorre=!1,s.muestraErrorTorre=!1,s.mensajeErrorTorre="",s.tipoMensaje="",s.createTorre=function(){var e=a.OnSubmitForm({form:"#frm-create-torre",css:".required",route:baseurl+"torres/create",fields:"",clear:!0});1==e?(s.muestraErrorTorre=!0,s.mensajeErrorTorre="Por favor, ingresa los datos de la torre",s.tipoMensaje="danger"):e.then(function(e){e.data.status&&(s.muestraErrorTorre=!0,s.mensajeErrorTorre=e.data.message,s.tipoMensaje="success",s.enableFormTorre=!1,s.item="",s.readTorres())}),o(function(){s.muestraErrorTorre=!1},2500)},s.dataTorres=[],s.readTorres=function(){"2"==tipocontrol&&t.post(baseurl+"torres/readbyid",{uid:uid}).then(function(e){e.data.status&&(s.dataTorres=e.data.rows)})},s.readOficinas=function(){t.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(s.dataResource=e.data.rows,s.loadDataResource=!0):s.loadDataResource=!1})},s.readTorres(),s.selectedTorre=0,s.detallesTorre=function(e){s.selectedTorre=e},s.showDeleteOption=function(e){s.torreToDelete=e},s.cancelTorreDelete=function(){s.torreToDelete=0},s.deleteTorre=function(e){t.post(baseurl+"torres/delete",{idTorre:e}).then(function(e){e.data.status?(s.muestraErrorTorre=!0,s.tipoMensaje="success",s.mensajeErrorTorre=e.data.message,s.torreToDelete=0,s.readTorres()):(s.muestraErrorTorre=!0,s.tipoMensaje="danger",s.mensajeErrorTorre=e.data.message)}),o(function(){s.muestraErrorTorre=!1},2500)},s.showDetails=function(e){s.seeDetails=e},s.selectItem=function(e){s.selectedIdResource=e},s.nombreTorre="",s.nombreOficina="",s.pisoNivel="",s.area="",s.integrantesOficina=[],s.requestDetails=function(e){(s.ocultaDetalleOficina=!1,s.ocultaFormCreacionOficina=!1,s.panelTorre=!1,s.listarIntegrantes=!1,"2"==tipocontrol)&&(s.muestraMensajeCarga="Cargando Oficinas ...",t.post(baseurl+r+"readbyidoficina",{id_oficina:e}).then(function(e){e.data.status&&(s.idOficina=e.data.rows[0].id_sg_oficina,s.nombreTorre=e.data.rows[0].nombre_torre,s.nombreOficina=e.data.rows[0].oficina,s.pisoNivel=e.data.rows[0].piso_nivel,s.area=e.data.rows[0].area,s.integrantesOficina=e.data.integrantes,s.resultResource=!0,s.item=e.data.rows[0].id_sg_torre,s.piso=e.data.rows[0].piso_nivel,s.oficina=e.data.rows[0].oficina,s.area=e.data.rows[0].area),s.muestraMensajeCarga="No hay datos que mostrar"}))},s.ocultaDetalleOficina=!1,s.ocultaFormCreacionOficina=!1,s.buttonCreateOficina=!0,s.addOffice=function(){s.buttonCreateOficina=!0,s.ocultaDetalleOficina=!0,s.ocultaFormCreacionOficina=!0,s.panelTorre=!1,s.item="",s.piso="",s.oficina="",s.area=""},s.oficinaMessage="",s.showMessageOficina=!1,s.recordCreated=!1,s.createOficina=function(){var e=a.OnSubmitForm({form:"#frm-create-oficina",css:".required",route:baseurl+"oficinas/create",fields:"",clear:!1});1==e?(s.oficinaMessage="Por favor, ingresa los datos de la oficina",s.showMessageOficina=!0):e.then(function(e){e.status&&(s.oficinaMessage=e.data.message,s.recordCreated=!0,a.resetForm("#frm-create-oficina"),t.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(s.dataResource=e.data.rows,s.loadDataResource=!0):s.loadDataResource=!1}))})},s.borraMensajeError=function(){s.showMessageOficina=!1},s.borraMensajeSuccess=function(){s.recordCreated=!1,s.ocultaDetalleOficina=!1,s.ocultaFormCreacionOficina=!1,s.item="",s.piso="",s.disableInputs=!1},s.another=function(){s.recordCreated=!1,s.item="",s.piso="",s.disableInputs=!1},s.closeAddOffice=function(){s.item="",s.piso="",s.disableInputs=!1,s.ocultaDetalleOficina=!1,s.ocultaFormCreacionOficina=!1},s.setScroll=function(e){if(5<e.length)return"setScroll"},s.cierraDetalles=function(){s.resultResource=!1,s.integrantesOficina=[]},s.cancelDelete=function(){s.selectedIdResource=""},s.resetForm=function(){s.item="",s.piso="",s.disableInputs=!1},s.mensajeErrorOficina="",s.muestraErrorOficina=!1,s.typeAlert="",s.deleteProcessOficina=function(e){t.post(baseurl+"oficinas/delete",{id_sg_oficina:e}).then(function(e){e.data.status?(s.mensajeErrorOficina=e.data.message,s.muestraErrorOficina=!0,s.typeAlert="success",s.item="",s.piso="",s.disableInputs=!1,s.readOficinas()):(s.mensajeErrorOficina=e.data.message,s.muestraErrorOficina=!0,s.typeAlert="danger",s.item="",s.piso="",s.disableInputs=!1),o(function(){s.muestraErrorOficina=!1},2500)})},s.editarOficina=function(){s.buttonCreateOficina=!1,s.ocultaDetalleOficina=!0,s.ocultaFormCreacionOficina=!0},s.messageEmpleados="",s.dataEmpleados=[],s.readEmpleados=function(){var e=t.post(baseurl+"empleados/readbyempresa",{uid:uid});s.messageEmpleados="Verificando ...",e.then(function(e){e.data.status?(s.loadDataEmpleados=!0,s.dataEmpleados=e.data.rows,s.messageEmpleados=""):(s.loadDataEmpleados=!1,s.messageEmpleados="No encontramos empleados")})},s.readEmpleados(),s.listarIntegrantes=!1,s.abrirIntegrantes=function(){s.listarIntegrantes=!0,s.ocultaDetalleOficina=!0},s.cierraIntegrantes=function(){s.listarIntegrantes=!1,s.ocultaDetalleOficina=!1},s.selectedEmpleado=0,s.muestraAsignacion=function(e){s.selectedEmpleado=e},s.asignaEmpleado=function(e){s.asignacionEmpleado=e},s.cancelAsignacion=function(){s.asignacionEmpleado=0},s.asignadoEmpleado=!1,s.muestraErrorAsignacion=!1,s.mensajeErrorAsignacion="",s.tipoMensaje="",s.procesaAsignacion=function(a,e){t.post(baseurl+"oficinas/asignaempleado",{idEmpleado:e,idOficina:a,idUser:uid}).then(function(e){e.data.status?(s.asignadoEmpleado=!0,s.asignacionEmpleado=0,s.requestDetails(a)):(s.muestraErrorAsignacion=!0,s.mensajeErrorAsignacion=e.data.message,s.tipoMensaje="danger")}),o(function(){s.muestraErrorAsignacion=!1},2500)},s.empleadoAsignado=0,s.removerEmpleadoOficina=function(e){s.empleadoAsignado=e},s.cancelaRemover=function(){s.empleadoAsignado=0},s.eliminaEmpleadoOficina=function(e,a){t.post(baseurl+"oficinas/deleteasignacion",{id_sg_personal:e}).then(function(e){e.data.status&&s.requestDetails(a)})},s.btnActualizaOficina="Actualizar",s.updateOficina=function(){var e=a.OnSubmitForm({form:"#frm-create-oficina",css:".required",route:baseurl+"oficinas/update",fields:"",clear:!1});if(1==e)return!1;s.btnActualizaOficina="Actualizando ...",e.then(function(e){e.data.status&&s.readOficinas(),s.btnActualizaOficina="Actualizar"})}}]);