"use strict";app.controller("analitica",["$scope",function(e){}]),app.controller("configuracion",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("dispositivos",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("empresas",["$scope","$http","Form","$timeout","Core","$window","$location","$document",function(r,l,o,i,n,d,a,e){r.dataEmpresas=[],r.loadDataEmpresas=!1,r.emptyStatus=!1,r.showCreateForm=!1,r.uid=uid,r.setMessage=!1,r.typeMessage="",r.messageText="",r.searchEmpleado="",r.showEditForm=!1,r.showDetailsEmpleado=!1,r.triggerSearch=!1,r.result=[],r.messageConfirm=!1,r.idEmpleado=0,r.customReport=!1,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.keepRegistering=!1,r.sede="",r.dataSedes=[],r.deleteSuccessSede=!1,r.showFormEditaSede=!0,r.showPlanes=!1,r.tiporegistro=1,l.post(baseurl+"empresas/readbyuser",{uid:uid}).then(function(e){if(e.data.status)for(var a in r.dataEmpresas=e.data.rows,r.dataEmpresas)r.dataEmpresas[a].estado&&(r.emptyStatus=!0);r.loadDataEmpresas=!0}),r.dataEmpleados=[],r.loadDataEmpleados=!1,r.messageEmpleados="",r.seeDetails=0,r.readEmpleados=function(){var e=l.post(baseurl+"empleados/readbyempresa",{uid:uid});r.messageEmpleados="Verificando ...",e.then(function(e){e.data.status?(r.loadDataEmpleados=!0,r.dataEmpleados=e.data.rows,r.messageEmpleados=""):(r.loadDataEmpleados=!1,r.messageEmpleados="No encontramos empleados")})},r.readEmpleados(),r.startToSearch=!1,r.$watch("result",function(e,a){e.length!=a.length&&e.length==a.length&&console.log("call")}),r.showDetails=function(e){r.showCreateForm=!1,r.showPlanes=!1,r.seeDetails=e},r.enableDetails=!1,r.requestDetails=function(e){r.idEmpleado=e,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showPlanes=!1,l.post(baseurl+"empleados/readbyid",{id_cms_empleado:e}).then(function(e){e.data.status&&(r.nombresApellidos=e.data.rows[0].nombres_personal+" "+e.data.rows[0].apellidos_personal,r.direccion=e.data.rows[0].direccion_personal,r.telefono=e.data.rows[0].telefono_personal,r.correo=e.data.rows[0].correo_personal,r.email=e.data.rows[0].correo_personal,r.photo=e.data.rows[0].photo_personal,r.enableDetails=!0,r.uid=e.data.rows[0].id_sg_personal,r.sede=e.data.rows[0].id_sg_sede.toString(),r.nombresede=e.data.rows[0].nombre_sede,r.cedula=e.data.rows[0].cedula_personal,r.nombres=e.data.rows[0].nombres_personal,r.apellidos=e.data.rows[0].apellidos_personal,r.direccion=e.data.rows[0].direccion_personal,r.telefono=e.data.rows[0].telefono_personal,r.correo=e.data.rows[0].correo_personal,r.estado=e.data.rows[0].id_sg_estado,r.showDetailsEmpleado=!1,r.showEditForm=!1)}),r.requestActividades(e)},r.dataResumenActividades=[],r.requestActividades=function(e){l.post(baseurl+"registros/obtenervisitas",{id_cms_empleado:e}).then(function(e){e.data.status?r.dataResumenActividades=e.data.rows:r.dataResumenActividades=[]})},r.cancelDetail=function(){r.uid=uid,r.enableDetails=!1,r.idEmpleado=0,o.resetForm("#frm-edita-empleado")},r.addEmpleado=function(){r.email="",r.uid=uid,r.keepRegistering=!1,r.showDetailsEmpleado=!0,r.showEditForm=!1,r.showCreateForm=!0,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showCreaDataSedes=!0,r.showPlanes=!1},r.editEmpleado=function(){r.showDetailsEmpleado=!0,r.enableDetails=!1,r.showEditForm=!0,r.keepRegistering=!1,r.showPlanes=!1},r.comebackToDetails=function(){r.uid=uid,r.showDetailsEmpleado=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showPlanes=!1,o.resetForm("#frm-edita-empleado")},r.btnRegistraEmpleado=!0,r.btnActualizaEmpleado=!1,r.email="",r.checkEmail=function(){r.btnRegistraEmpleado=!0,r.email.match(/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/)?(r.btnActualizaEmpleado=!1,r.btnRegistraEmpleado=!1):(r.btnRegistraEmpleado=!0,r.btnActualizaEmpleado=!0)},r.createEmpleado=function(){var e=o.OnSubmitForm({form:"#frm-create-empleado",css:".required",route:baseurl+"empleados/create",fields:"",clear:!1});1==e?(r.setMessage=!0,r.typeMessage="danger",r.messageText="Por favor, Ingrese los Datos",i(function(){r.setMessage=!1},2500)):e.then(function(e){e.data.status?(r.setMessage=!0,r.typeMessage="success",r.messageText="Has registrado tu empleado!",r.readEmpleados(),r.keepRegistering=!0,s(".comboBoxEmpleados",e.data.append.id,e.data.append.prop),o.resetForm("#frm-create-empleado"),i(function(){r.setMessage=!1})):(r.setMessage=!0,r.typeMessage="danger",r.messageText=e.data.message,i(function(){r.setMessage=!1},2500))})},r.done=function(){r.setMessage=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showDetailsEmpleado=!1,r.keepRegistering=!1,r.showPlanes=!1},r.another=function(){r.uid=uid,r.keepRegistering=!1,r.showDetailsEmpleado=!0,r.showEditForm=!1,r.showCreateForm=!0,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.setMessage=!1,r.showPlanes=!1},r.editaEmpleado=function(){var e=o.OnSubmitForm({form:"#frm-edita-empleado",css:".required",route:baseurl+"empleados/update",fields:"",clear:!1});1==e?(r.setMessage=!0,r.typeMessage="danger",r.messageText="Por favor, Ingrese los Datos",i(function(){r.setMessage=!1},2500)):e.then(function(e){e.data.status?(r.setMessage=!0,r.typeMessage="success",r.messageText=e.data.message,r.readEmpleados(),r.keepRegistering=!0,i(function(){r.setMessage=!1,r.showCreateForm=!1,r.showEditForm=!1,r.showDetailsEmpleado=!1,r.enableDetails=!1},2500)):(r.setMessage=!0,r.typeMessage="danger",r.messageText=e.data.message,i(function(){r.setMessage=!1},2500))})},r.activateEmpleado=function(e,a){"1"==e?(l.post(baseurl+"empleados/disable",{id_cms_empleado:a,state:"2"}).then(function(e){e.data.status&&r.readEmpleados()}),r.estado="2"):(l.post(baseurl+"empleados/disable",{id_cms_empleado:a,state:"1"}).then(function(e){e.data.status&&r.readEmpleados()}),r.estado="1")},r.showListEmpleados=!1,r.dataVisitasEmpleado=[],r.reporteVisitasSedes=[],r.seeDetailsInOut=function(){r.showDetailsActivitys=!0,r.showListEmpleados=!0,r.showDetailsEmpleado=!0,r.showResumeEmpleados=!1,r.customReportInOut=!0,r.customReport=!0,r.showCreateForm=!1,r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showEditForm=!1,r.cedulaCheck=!0,r.nombresCheck=!0,r.apellidosCheck=!0,r.sedeCheck=!0,r.entradaCheck=!0,r.salidaCheck=!0,r.showPlanes=!1,l.post(baseurl+"registros/obtenervisitas",{id_cms_empresa:uid}).then(function(e){e.data.status&&(r.dataVisitasEmpleado=e.data.rows)});var e=l.post(baseurl+"reportes/reporteporsedes",{id_cms_empresa:uid}),t=[],s=[];e.then(function(e){if(e.data.status){r.reporteVisitasSedes=e.data.rows;for(var a in r.reporteVisitasSedes)t.push(r.reporteVisitasSedes[a].sede),s.push(parseInt(r.reporteVisitasSedes[a].visitas));c(t,s),u(t,s),p(t,s)}else r.reporteVisitasSedes=[]})};var c=function(e,a){var t=$("#chart-bars"),s=new Chart(t,{type:"bar",data:{labels:e,datasets:[{label:"Visitas",data:a}]}});t.data("chart",s)},u=function(e,a){var t=$("#chart-lines"),s=new Chart(t,{type:"line",options:{scales:{yAxes:[{gridLines:{color:Charts.colors.gray[200],zeroLineColor:Charts.colors.gray[200]},ticks:{}}]}},data:{labels:e,datasets:[{label:"Performance",data:a}]}});t.data("chart",s)},p=function(e,a){var t=$("#chart-pie"),s=new Chart(t,{type:"pie",data:{labels:e,datasets:[{data:a,backgroundColor:[Charts.colors.theme.danger,Charts.colors.theme.warning,Charts.colors.theme.success,Charts.colors.theme.primary,Charts.colors.theme.info],label:"Dataset 1"}]},options:{responsive:!0,legend:{position:"top"},animation:{animateScale:!0,animateRotate:!0}}});t.data("chart",s)};r.closeShowGraphics=function(){r.showGraphics=!1,r.showPlanes=!1},r.closeDetailsInOut=function(){r.showListEmpleados=!1,r.showDetailsEmpleado=!1,r.showResumeEmpleados=!1,r.customReportInOut=!1,r.customReport=!1,r.showPlanes=!1,r.showDetailsActivitys=!1},r.selectedId,r.selectItem=function(e){r.selectedId=e},r.deleteSuccess=!1,r.reloadingEmpleados="",r.deleteProcessEmpleado=function(e,a,t){var s=l.post(baseurl+"empleados/delete",{id_cms_empleado:e}),o=a+" "+t;r.deleteSuccess=!0,r.reloadingEmpleados="Actualizando ...",s.then(function(e){e.data.status&&(r.readEmpleados(),r.reloadingEmpleados="Empleado Eliminado",m(".comboBoxEmpleados",o),r.enableDetails=!1,i(function(){r.deleteSuccess=!1},2500))})},r.cancelProcess=function(e){r.selectedId=""},r.customeReport=function(){r.customReport=!0,r.customReportInOut=!0,r.showPlanes=!1},r.closeCustomReport=function(){r.customReport=!1,r.customReportInOut=!1,r.showPlanes=!1},r.dataDetalleEmpleados=[],r.loadDetalleEmpleados=!1,r.verMisEmpleados=function(){r.loadDetalleEmpleados=!0,r.showDetailsEmpleado=!0,r.showResumeEmpleados=!0,r.customReport=!1,r.customReportInOut=!0,r.showListEmpleados=!1,r.dataDetalleEmpleados=[],r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.showCreateForm=!1,r.showPlanes=!1,r.showDetailsActivitys=!1,l.post(baseurl+"empleados/readbyempresa",{uid:uid}).then(function(e){e.data.status?r.dataDetalleEmpleados=e.data.rows:r.dataDetalleEmpleados=[],r.loadDetalleEmpleados=!1})},r.setScroll=function(e){if(5<e.length)return"setScroll"},r.increase=0,r.createdEmpresa=!1,r.showBackMessage=!1,r.modulo="",r.recoveryStep=function(){var e=d.localStorage.getItem("paso");if(n.isEmpty(e))r.increase=0;else{var a=JSON.parse(e);r.increase=a.paso,r.modulo=a.modulo,r.showBackMessage=a.left,r.tipoRegistroSigga=a.tipo}},r.next=function(e,a){switch(r.modulo=e,r.tipoRegistroSigga=a,e){case"mipersonal":r.increase++;var t=d.localStorage.getItem("paso");if(null==(s=JSON.parse(t))){var s={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:1,entrypoint:"#!/empresas",user:uid})}else if(s.executed)s={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};d.localStorage.setItem("paso",JSON.stringify(s));break;case"visitantes":r.increase++;t=d.localStorage.getItem("paso");if(null==(s=JSON.parse(t))){s={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:2,entrypoint:"#!/visitantes",user:uid,control:1})}else if(s.executed)switch(a){case"residencial":s={paso:r.increase,modulo:e,left:!0,executed:!0,tipo:a,uid:r.uid};r.updateTipoControl({user:uid,control:1});break;case"empresa":s={paso:r.increase,modulo:e,left:!0,executed:!0,tipo:a,uid:r.uid};r.updateTipoControl({user:uid,control:2})}d.localStorage.setItem("paso",JSON.stringify(s));break;case"proveedores":r.increase++;s={paso:r.increase,modulo:e,left:!0,executed:!0,uid:r.uid};r.updateTipoRegistro({tiporegistro:2,entrypoint:"#!/proveedores",user:uid,control:2,uid:r.uid}),d.localStorage.setItem("paso",JSON.stringify(s))}},r.updateTipoRegistro=function(e){l.post(baseurl+"usuarios/updatetiporegistro",e).then(function(e){if(e.data.status)return!0})},r.updateTipoControl=function(e){l.post(baseurl+"usuarios/updatetipocontrol",e).then(function(e){if(e.data.status)return!0})},r.prev=function(){r.increase--;var e={paso:r.increase,left:!0};d.localStorage.setItem("paso",e)},r.recoveryStep(),r.errorMessageEmpresa="",r.errorMessageUnidad="",r.errorCreated=!1,r.createUnidad=!1,r.createUnidadResidencial=function(){var e=o.OnSubmitForm({form:"#frm-create-unidad",css:".required",route:baseurl+"unidad/create",fields:"",clear:!1});1==e?(r.errorMessageUnidad="Por favor, Ingresa los datos de tu empresa",r.errorCreated=!0):e.then(function(e){e.data.status?(r.createdUnidad=!0,o.resetForm("#frm-create-unidad")):(r.errorMessageUnidad="Ocurrio algo!, no hemos podido crear tu Unidad, porfavor intentalo de nuevo",r.errorCreated=!0)})},r.createempresa=function(){var e=o.OnSubmitForm({form:"#frm-create-empresa",css:".required",route:baseurl+"empresas/create",fields:"",clear:!1});1==e?(r.errorMessageEmpresa="Por favor, Ingresa los datos de tu empresa",r.errorCreated=!0):e.then(function(e){e.data.status?(r.createdEmpresa=!0,o.resetForm("#frm-create-empresas")):(r.errorMessageEmpresa=e.data.message,r.errorCreated=!0)})},r.errorMessageEmpresaVisitante="",r.errorCreatedEmpresaVisitante=!1,r.createEmpresaVisitante=function(){var e=o.OnSubmitForm({form:"#frm-create-empresa-visitante",css:".required",route:baseurl+"empresas/create",fields:"",clear:!1});1==e?(r.errorMessageEmpresaVisitante="Por favor, Ingresa los datos de tu empresa",r.errorCreatedEmpresaVisitante=!0):e.then(function(e){e.data.status?(r.errorCreatedEmpresaVisitante=!0,o.resetForm("#frm-create-empresa-visitante")):(r.errorMessageEmpresaVisitante=e.data.message,r.errorCreatedEmpresaVisitante=!0)})},r.btnUpdateEmpresa="Actualiza mi Empresa",r.editaempresa=function(){r.btnUpdateEmpresa="Actualizando...";var e=o.OnSubmitForm({form:"#frm-edita-empresa",css:".required",route:baseurl+"empresas/update",fields:"",clear:!1});1==e?(r.errorMessageEmpresa="Por favor, Ingresa los datos de tu empresa",r.typeMessage="danger",r.errorCreated=!0):(e.then(function(e){e.data.status?(r.errorCreated=!0,r.errorMessageEmpresa=e.data.message,r.typeMessage="success"):(r.errorMessageEmpresa=e.data.message,r.errorCreated=!0,r.typeMessage="danger")}),r.btnUpdateEmpresa="Actualiza mi Empresa")},r.errorMessageSede="",r.errorCreatedSede=!1,r.createdSede=!1,r.createSede=function(){var e=o.OnSubmitForm({form:"#frm-create-sede",css:".required",route:baseurl+"sedes/create",fields:"",clear:!1});1==e?(r.errorMessageSede="Por favor, Ingresa los datos de tu sede",r.errorCreatedSede=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0,r.createdSede=!0,o.resetForm("#frm-create-sede")):(r.typeMessage="danger",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0),r.getDataSedes(uid,e.data.status)})},r.errorMessageSedeVisitante="",r.errorCreatedSedeVisitante=!1,r.createSedeVisitante=function(){var e=o.OnSubmitForm({form:"#frm-create-sede-visitante",css:".required",route:baseurl+"sedes/create",fields:"",clear:!1});1==e?(r.errorMessageSedeVisitante="Por favor, ingrese los datos",r.errorCreatedSedeVisitante=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSedeVisitante=e.data.message,r.errorCreatedSedeVisitante=!0,r.createdSedeVisitante=!0,o.resetForm("#frm-create-sede")):(r.typeMessage="danger",r.errorMessageSedeVisitante=e.data.message,r.errorCreatedSedeVisitante=!0),r.getDataSedes(uid,e.data.status)})},r.getInSigga=function(){var e=d.localStorage.getItem("paso");switch(JSON.parse(e).modulo){case"mipersonal":d.location.reload(),d.localStorage.removeItem("paso"),location.reload();break;case"visitantes":a.path("/visitantes"),d.localStorage.removeItem("paso"),location.reload();break;case"proveedores":a.path("/proveedores"),d.localStorage.removeItem("paso")}},r.goToSection=function(){a.hash("detalles"),$anchorScroll()},r.showEditaDataEmpresa=!0,r.showEditaDataSedes=!0,r.loadDataSedes=!1,r.messageSedes="",r.searchSedes="",r.editarEmpresa=function(){r.showEditaDataEmpresa=!1,r.showDetailsActivitys=!1,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showEditaDataSedes=!0,r.showResumeEmpleados=!1,r.showListEmpleados=!1,r.customReportInOut=!0,r.customReport=!1,r.showEditForm=!1,r.showCreateForm=!1,r.showPlanes=!1,l.post(baseurl+"empresas/readbyid",{id_cms_empresas:uid}).then(function(e){e.data.status&&(r.idEmpresa=e.data.rows[0].id_sg_empresa,r.empresa=e.data.rows[0].empresa,r.nit=e.data.rows[0].nit,r.correo=e.data.rows[0].email,r.direccion=e.data.rows[0].direccion,r.estado=e.data.rows[0].estado)})},r.editarSede=function(){r.showDetailsActivitys=!1,r.showEditaDataSedes=!1,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showResumeEmpleados=!1,r.showListEmpleados=!1,r.customReportInOut=!0,r.customReport=!1,r.showEditForm=!1,r.showCreateForm=!1,r.showPlanes=!1,r.getDataSedes(uid,!1)},r.closeSede=function(){r.showEditaDataEmpresa=!0,r.showDetailsEmpleado=!1,r.customReportInOut=!1,r.showEditaDataSedes=!0,r.errorCreated=!1,r.showPlanes=!1},r.closeEditEmpresa=function(){r.showEditaDataEmpresa=!0,r.showDetailsEmpleado=!1,r.customReportInOut=!1,r.showEditaDataSedes=!0,r.errorCreated=!1,r.showPlanes=!1},r.getDataSedes=function(e,a){l.post(baseurl+"sedes/readbyidempresa",{idusuario:e}).then(function(e){e.data.status&&(r.dataSedes=e.data.rows,a&&(s(".comboBoxSedes",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede),s(".comboBoxSedeEdit",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede),s(".comboBoxSedesCreate",e.data.rows[0].id_sg_sede,e.data.rows[0].nombre_sede)))})},r.showCreaDataSedes=!0,r.addSede=function(){r.showCreaDataSedes=!1,r.showEditaDataSedes=!0,r.errorCreatedSede=!1,r.showPlanes=!1},r.cancelAddSede=function(){r.showCreaDataSedes=!0,r.showEditaDataSedes=!1,r.createdSede=!1,r.showFormEditaSede=!0,r.showPlanes=!1},r.doneSede=function(){r.errorCreatedSede=!0,r.cancelAddSede()},r.anotherSede=function(){r.errorCreatedSede=!1,r.errorMessageSede="",r.createdSede=!1,r.addSede()},r.editSede=function(e){r.showEditaDataSedes=!0,r.showFormEditaSede=!1,r.errorCreatedSede=!1,r.showPlanes=!1,l.post(baseurl+"sedes/readbyid",{id_cms_sede:e}).then(function(e){e.data.status&&(o.resetForm("#frm-edita-sede"),r.idSede=e.data.rows[0].id_sg_sede,r.nombreSede=e.data.rows[0].nombre_sede,r.dirSede=e.data.rows[0].direccion_sede,r.telefonoSede=e.data.rows[0].telefono_sede)})},r.editProcessData=function(){var e=o.OnSubmitForm({form:"#frm-edita-sede",css:".required",route:baseurl+"sedes/update",fields:"",clear:!1});1==e?(r.errorMessageSede="Por favor, Ingresa los datos de tu sede",r.errorCreatedSede=!0):e.then(function(e){e.data.status?(r.typeMessage="success",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0,r.createdSede=!0,r.readEmpleados()):(r.typeMessage="danger",r.errorMessageSede=e.data.message,r.errorCreatedSede=!0),r.getDataSedes(uid)})},r.deleteProcessSede=function(a){var e=l.post(baseurl+"sedes/delete",{id_cms_sede:a});r.deleteSuccessSede=!0,r.reloadingSede="Actualizando ...",r.typeMessage="info",e.then(function(e){e.data.status?(r.getDataSedes(uid),r.reloadingSede="Sede Eliminada",r.enableDetails=!1,r.selectedId="",r.typeMessage="success",t(".comboBoxSedes",a),t(".comboBoxSedesCreate",a),i(function(){r.deleteSuccessSede=!1},2500)):(r.reloadingSede=e.data.message,r.enableDetails=!1,r.selectedId="",r.typeMessage="danger",i(function(){r.deleteSuccessSede=!1},4e3))})};var t=function(e,a){$(e+' option[value="'+a+'"]').each(function(){$(this).remove()})},m=function(e,a){$(e+" option").each(function(){$(this).text()===a&&$(this).remove()})},s=function(e,a,t){$(e).append('<option value="'+a+'">'+t+"</option>")};r.arguments=[],r.cedulaCheck=!0,r.nombresCheck=!0,r.apellidosCheck=!0,r.sedeCheck=!0,r.entradaCheck=!0,r.salidaCheck=!0,r.sedeOption="",r.fechaDesde="",r.fechaHasta="",r.entradaSalidaOption="",r.empleadoOption="",r.showMessageErrorReporte=!1,r.generateReporte=function(){var e=o.serializeForm('#frm-generate-report input[type="checkbox"]');if(r.arguments=[],n.isEmpty(r.sedeOption)||n.isEmpty(r.fechaDesde)||n.isEmpty(r.fechaHasta)||n.isEmpty(r.entradaSalidaOption))r.showMessageErrorReporte=!0;else{for(var a in r.showMessageErrorReporte=!1,e)"on"==e[a]&&r.arguments.push(a);if(n.isEmpty(r.empleadoOption))t={fields:r.arguments.join(", "),id_cms_empresa:uid,desde:f(r.fechaDesde),hasta:f(r.fechaHasta),sede:r.sedeOption,entradaSalida:r.entradaSalidaOption};else var t={fields:r.arguments.join(", "),id_cms_empresa:uid,desde:f(r.fechaDesde),hasta:f(r.fechaHasta),sede:r.sedeOption,entradaSalida:r.entradaSalidaOption,empleado:r.empleadoOption};var s=l.post(baseurl+"registros/obtenerreporteactividades",t);r.dataVisitasEmpleado=[],s.then(function(e){e.data.status?r.dataVisitasEmpleado=e.data.rows:r.dataVisitasEmpleado=[]})}};var f=function(e){var a=new Date(e);return a.getFullYear()+"-"+g(a.getMonth()+1)+"-"+g(a.getDate())},g=function(e){return e<10?"0"+e:e};r.exportToExcel=function(e,a,t){for(var s=l.post(baseurl+e,t),o=$(a),r=[],i=0;i<o.length;i++){var n=o[i];r.push(n.textContent)}var d=[],c=[];d.push(r),s.then(function(e){e.data.status&&$.each(e.data.rows,function(e,a){c=[],$.each(a,function(e,a){c.push(a)}),d.push(c)}),d.push(c);var a=XLSX.utils.book_new(),t=XLSX.utils.aoa_to_sheet(d);XLSX.utils.book_append_sheet(a,t,"Sigga_Mi_Personal"),XLSX.writeFile(a,"Reporte_Mi_Personal.xlsx")})},r.generateReportPDF=function(){},r.showGraphics=!1,r.showResumeGraphics=function(){r.showGraphics=!0},r.showPlanesData=function(){r.showPlanes=!0,r.showListEmpleados=!0,r.showDetailsEmpleado=!0,r.customReportInOut=!0,r.showDetailsActivitys=!1,r.customReport=!1},$(".tooltip-message").tooltip()}]),app.controller("personal",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("reportes",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("residencial",["$scope","$http","Core","Form","$timeout",function(t,s,e,a,o){t.uid=uid,t.dataApartamentos=[],t.dataTorres=[],t.loadDataApartamentos=!1,t.cedula=0,t.telefono=0,t.torre="",t.dataResource=[],t.searchApartamento="",t.pisoapto=0,t.getApartamentos=function(){s.post(baseurl+"apartamentos/readbyid",{uid:uid}).then(function(e){e.data.status&&(t.dataApartamentos=e.data.rows,t.dataResource=e.data.rows,t.loadDataApartamentos=!0)})},t.getTorres=function(){s.post(baseurl+"torres/readbyid",{uid:uid}).then(function(e){e.data.status&&(t.dataTorres=e.data.rows)})},t.getApartamentos(),t.getTorres(),t.detalleApto=!0,t.estadoFormApto=!1,t.estadoFormTorre=!1,t.openAddApto=function(){t.torre="",t.pisoapto=0,t.nombreapto="",t.estadoapto="0",t.detalleApto=!1,t.estadoFormApto=!0,t.showEditFormApto=!1},t.closeAddApto=function(){t.detalleApto=!0,t.estadoFormApto=!1},t.openAddTorre=function(){"2"==t.torre&&(t.estadoFormApto=!1,t.estadoFormTorre=!0),"0"==t.torre&&(t.estadoFormApto=!1,t.estadoFormResidente=!0)},t.closeAddTorre=function(){t.estadoFormApto=!0,t.estadoFormTorre=!1},t.btnCreateTorre="Registrar Torre",t.showMessageTorre=!1,t.type="",t.createTorre=function(){var e=a.OnSubmitForm({form:"#frm-create-torre",css:".required",route:baseurl+"torres/create",fields:"",clear:!1});t.btnCreateTorre="Registrando ...",1==e?(t.type="danger",t.messageErrorTorre="Por favor, ingrese el nombre de la torre",t.showMessageTorre=!0,t.btnCreateTorre="Registrar Torre"):e.then(function(e){e.data.status?(t.type="success",t.messageErrorTorre=e.data.message,t.showMessageTorre=!0,t.btnCreateTorre="Registrar Torre",t.getTorres()):(t.type="danger",t.messageErrorTorre=e.data.message,t.showMessageTorre=!0)}),o(function(){t.showMessageTorre=!1},2500)},t.btnCreateApto="Registrar",t.messageErrorApto="",t.showMessageApto=!1,t.type="",t.createApto=function(){var e=a.OnSubmitForm({form:"#frm-create-apto",css:".required",route:baseurl+"apartamentos/create",fields:"",clear:!1});t.btnCreateApto="Registrando ...",1==e?(t.type="danger",t.messageErrorApto="Por favor, ingresa los datos del Apartamento",t.showMessageApto=!0,t.btnCreateApto="Registrar"):e.then(function(e){e.data.status?(t.type="success",t.messageErrorApto=e.data.message,t.showMessageApto=!0,t.btnCreateApto="Registrar",t.closeAddApto(),t.getApartamentos(),a.resetForm("#frm-create-apto")):(t.type="danger",t.messageErrorApto=e.data.message,t.showMessageApto=!0)}),o(function(){t.showMessageApto=!1},2500)},t.verDetalle=0,t.selectIdApto=0,t.muestraMensajeCarga="No hay detalles que mostrar",t.resultDataApto=!1,t.dataDetalles=[],t.mostrarDetalles=function(e){t.verDetalle=e},t.opcionesApto=!1,t.requestDetalles=function(e){var a=s.post(baseurl+"apartamentos/readbyidapto",{id:e});t.detalleApto=!0,t.estadoFormApto=!1,t.muestraMensajeCarga="Cargando detalles ...",a.then(function(e){e.data.status&&(t.dataDetalles=e.data.rows[0],t.resultDataApto=!0,t.idApto=t.dataDetalles.id_sg_apto,t.torre=t.dataDetalles.id_sg_torre,$("#estadoApto").val(t.dataDetalles.id_sg_estado).change(),t.pisoapto=parseInt(t.dataDetalles.piso_apto),t.nombreapto=t.dataDetalles.numero_apto),t.opcionesApto=!0,t.muestraMensajeCarga="No hay detalles que mostrar"})},t.showEditFormApto=!1,t.openEditForm=function(){t.requestDetalles(t.idApto),t.estadoFormApto=!0,t.detalleApto=!1,t.showEditFormApto=!0},t.cancelEditApto=function(){t.resultDataApto=!1,t.opcionesApto=!1},t.btnActualizaApto="Actualizar",t.updateApto=function(){var e=a.OnSubmitForm({form:"#frm-create-apto",css:".required",route:baseurl+"apartamentos/update",fields:"",clear:!1});t.btnActualizaApto="Actualizando ...",1==e?(t.type="danger",t.messageErrorApto="Por favor, ingresa los datos del Apartamento",t.showMessageApto=!0,t.btnActualizaApto="Actualizar"):e.then(function(e){e.data.status?(t.type="success",t.messageErrorApto=e.data.message,t.showMessageApto=!0,t.btnActualizaApto="Actualizar",t.getApartamentos(),a.resetForm("#frm-create-apto")):(t.type="danger",t.messageErrorApto=e.data.message,t.showMessageApto=!0,t.btnActualizaApto="Actualizar")}),o(function(){t.showMessageApto=!1},2500)},t.selectItem=function(e){t.selectIdApto=e},t.type="danger",t.messageDeleteApto="Por favor, ingresa los datos del Apartamento",t.showMessageDeleteApto=!1,t.deleteProcessApto=function(e){s.post(baseurl+"apartamentos/delete",{id:e}).then(function(e){e.data.status?(t.type="success",t.messageDeleteApto=e.data.message,t.showMessageDeleteApto=!0,t.resultDataApto=!1,t.getApartamentos()):(t.type="danger",t.messageDeleteApto=e.data.message,t.showMessageDeleteApto=!0)}),o(function(){t.showMessageDeleteApto=!1},3e3)},t.cancelDelete=function(){t.selectIdApto=0},t.btnCreateResidente="Registrar Residente",t.btnDisableCreate=!0,t.messageErrorResidente="",t.showMessageResidente=!1,t.createResidente=function(){var e=a.OnSubmitForm({form:"#frm-create-residente",css:".required",route:baseurl+"residentes/create",fields:"",clear:!1});t.btnCreateResidente="Registrando ...",t.btnDisableCreate=!0,1==e?(t.type="danger",t.messageErrorResidente="Por favor, ingresa los datos del Apartamento",t.showMessageResidente=!0,t.btnCreateResidente="Registrar Residente"):e.then(function(e){e.data.status?(t.type="success",t.messageErrorResidente=e.data.message,t.showMessageResidente=!0,t.btnCreateResidente="Registrar Residente",t.estadoFormApto=!0,t.estadoFormResidente=!1,a.resetForm("#frm-create-residente")):(t.type="danger",t.messageErrorResidente=e.data.message,t.showMessageResidente=!0,t.btnDisableCreate=!1,t.btnCreateResidente="Registrar Residente")}),o(function(){t.showMessageResidente=!1},2500)},t.closeAddResidente=function(){t.estadoFormResidente=!1},t.correo="",t.checkEmail=function(){t.btnDisableCreate=!0,t.correo.match(/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/)?t.btnDisableCreate=!1:t.btnDisableCreate=!0},t.addResidente=function(){}}]),app.controller("usuarios",["$scope",function(e){console.log("esta es una prueba")}]),app.controller("visitantes",["$scope","$http","rx","Form","$timeout",function(t,s,e,a,o){var r="1"==tipocontrol?"apartamentos/":"oficinas/";t.uid=uid,t.dataResource=[],t.loadDataResource=!1,t.searchResource="",t.selectedIdResource="",t.cedula=0,t.telefono=0,t.showCreateForm=!1,t.seeDetails=0,t.resultResource=!1,t.panelTorre=!1,t.enableFormTorre=!1,t.muestraMensajeCarga="No hay datos que mostrar",t.idOficina=0,t.searchEmpleado="",t.searchTorre="",t.searchIntegrante="",s.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(t.dataResource=e.data.rows,t.loadDataResource=!0):t.loadDataResource=!1}),t.openTorre=function(){t.panelTorre=!0,t.ocultaDetalleOficina=!0,t.enableFormTorre=!1,t.ocultaDetalleOficina=!0,t.ocultaFormCreacionOficina=!1,t.integrantesOficina=[]},t.item="",t.piso="",t.disableInputs=!1,t.changeFormTorre=function(){"N/A"==$("#idTorre option:selected").text()?(t.piso="N/A",t.disableInputs=!0):(t.piso="",t.disableInputs=!1,2==t.item?t.enableFormTorre=!0:t.enableFormTorre=!1)},t.closeTorre=function(){t.panelTorre=!1,t.ocultaDetalleOficina=!1},t.cancelAddTorre=function(){t.enableFormTorre=!1,t.item=""},t.createdTorre=!1,t.muestraErrorTorre=!1,t.mensajeErrorTorre="",t.tipoMensaje="",t.createTorre=function(){var e=a.OnSubmitForm({form:"#frm-create-torre",css:".required",route:baseurl+"torres/create",fields:"",clear:!0});1==e?(t.muestraErrorTorre=!0,t.mensajeErrorTorre="Por favor, ingresa los datos de la torre",t.tipoMensaje="danger"):e.then(function(e){e.data.status&&(t.muestraErrorTorre=!0,t.mensajeErrorTorre=e.data.message,t.tipoMensaje="success",t.enableFormTorre=!1,t.item="",t.readTorres())}),o(function(){t.muestraErrorTorre=!1},2500)},t.dataTorres=[],t.readTorres=function(){"2"==tipocontrol&&s.post(baseurl+"torres/readbyid",{uid:uid}).then(function(e){e.data.status&&(t.dataTorres=e.data.rows)})},t.readOficinas=function(){s.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(t.dataResource=e.data.rows,t.loadDataResource=!0):t.loadDataResource=!1})},t.readTorres(),t.selectedTorre=0,t.detallesTorre=function(e){t.selectedTorre=e},t.showDeleteOption=function(e){t.torreToDelete=e},t.cancelTorreDelete=function(){t.torreToDelete=0},t.deleteTorre=function(e){s.post(baseurl+"torres/delete",{idTorre:e}).then(function(e){e.data.status?(t.muestraErrorTorre=!0,t.tipoMensaje="success",t.mensajeErrorTorre=e.data.message,t.torreToDelete=0,t.readTorres()):(t.muestraErrorTorre=!0,t.tipoMensaje="danger",t.mensajeErrorTorre=e.data.message)}),o(function(){t.muestraErrorTorre=!1},2500)},t.showDetails=function(e){t.seeDetails=e},t.selectItem=function(e){t.selectedIdResource=e},t.nombreTorre="",t.nombreOficina="",t.pisoNivel="",t.area="",t.integrantesOficina=[],t.requestDetails=function(e){(t.ocultaDetalleOficina=!1,t.ocultaFormCreacionOficina=!1,t.panelTorre=!1,t.listarIntegrantes=!1,"2"==tipocontrol)&&(t.muestraMensajeCarga="Cargando Oficinas ...",s.post(baseurl+r+"readbyidoficina",{id_oficina:e}).then(function(e){e.data.status&&(t.idOficina=e.data.rows[0].id_sg_oficina,t.nombreTorre=e.data.rows[0].nombre_torre,t.nombreOficina=e.data.rows[0].oficina,t.pisoNivel=e.data.rows[0].piso_nivel,t.area=e.data.rows[0].area,t.integrantesOficina=e.data.integrantes,t.resultResource=!0,$("#idTorre").val(e.data.rows[0].id_sg_torre).change(),t.item=e.data.rows[0].id_sg_torre,t.piso=e.data.rows[0].piso_nivel,t.oficina=e.data.rows[0].oficina,t.area=e.data.rows[0].area),t.muestraMensajeCarga="No hay datos que mostrar"}))},t.ocultaDetalleOficina=!1,t.ocultaFormCreacionOficina=!1,t.buttonCreateOficina=!0,t.addOffice=function(){t.buttonCreateOficina=!0,t.ocultaDetalleOficina=!0,t.ocultaFormCreacionOficina=!0,t.panelTorre=!1,t.item="",t.piso="",t.oficina="",t.area=""},t.oficinaMessage="",t.showMessageOficina=!1,t.recordCreated=!1,t.createOficina=function(){var e=a.OnSubmitForm({form:"#frm-create-oficina",css:".required",route:baseurl+"oficinas/create",fields:"",clear:!1});1==e?(t.oficinaMessage="Por favor, ingresa los datos de la oficina",t.showMessageOficina=!0):e.then(function(e){e.data.status&&(t.oficinaMessage=e.data.message,t.recordCreated=!0,a.resetForm("#frm-create-oficina"),s.post(baseurl+r+"readbyid",{uid:uid}).then(function(e){e.data.status?(t.dataResource=e.data.rows,t.loadDataResource=!0):t.loadDataResource=!1}))})},t.borraMensajeError=function(){t.showMessageOficina=!1},t.borraMensajeSuccess=function(){a.resetForm("#frm-create-oficina"),t.recordCreated=!1,t.ocultaDetalleOficina=!1,t.ocultaFormCreacionOficina=!1,t.disableInputs=!1},t.another=function(){a.resetForm("#frm-create-oficina"),t.recordCreated=!1,t.disableInputs=!1},t.closeAddOffice=function(){t.disableInputs=!1,t.ocultaDetalleOficina=!1,t.ocultaFormCreacionOficina=!1},t.setScroll=function(e){if(5<e.length)return"setScroll"},t.cierraDetalles=function(){t.resultResource=!1,t.integrantesOficina=[]},t.cancelDelete=function(){t.selectedIdResource=""},t.resetForm=function(){t.item="",t.piso="",t.disableInputs=!1},t.mensajeErrorOficina="",t.muestraErrorOficina=!1,t.typeAlert="",t.deleteProcessOficina=function(e){s.post(baseurl+"oficinas/delete",{id_sg_oficina:e}).then(function(e){e.data.status?(t.mensajeErrorOficina=e.data.message,t.muestraErrorOficina=!0,t.typeAlert="success",t.disableInputs=!1,t.readOficinas()):(t.mensajeErrorOficina=e.data.message,t.muestraErrorOficina=!0,t.typeAlert="danger",t.disableInputs=!1),o(function(){t.muestraErrorOficina=!1},2500)})},t.editarOficina=function(){t.requestDetails(t.idOficina),t.buttonCreateOficina=!1,t.ocultaDetalleOficina=!0,t.ocultaFormCreacionOficina=!0},t.messageEmpleados="",t.dataEmpleados=[],t.readEmpleados=function(){var e=s.post(baseurl+"empleados/readbyempresa",{uid:uid});t.messageEmpleados="Verificando ...",e.then(function(e){e.data.status?(t.loadDataEmpleados=!0,t.dataEmpleados=e.data.rows,t.messageEmpleados=""):(t.loadDataEmpleados=!1,t.messageEmpleados="No encontramos empleados")})},t.readEmpleados(),t.listarIntegrantes=!1,t.abrirIntegrantes=function(){t.listarIntegrantes=!0,t.ocultaDetalleOficina=!0},t.cierraIntegrantes=function(){t.listarIntegrantes=!1,t.ocultaDetalleOficina=!1},t.selectedEmpleado=0,t.muestraAsignacion=function(e){t.selectedEmpleado=e},t.asignaEmpleado=function(e){t.asignacionEmpleado=e},t.cancelAsignacion=function(){t.asignacionEmpleado=0},t.asignadoEmpleado=!1,t.muestraErrorAsignacion=!1,t.mensajeErrorAsignacion="",t.tipoMensaje="",t.procesaAsignacion=function(a,e){s.post(baseurl+"oficinas/asignaempleado",{idEmpleado:e,idOficina:a,idUser:uid}).then(function(e){e.data.status?(t.asignadoEmpleado=!0,t.asignacionEmpleado=0,t.muestraErrorAsignacion=!0,t.mensajeErrorAsignacion=e.data.message,t.tipoMensaje="success",t.requestDetails(a)):(t.muestraErrorAsignacion=!0,t.mensajeErrorAsignacion=e.data.message,t.tipoMensaje="danger")}),o(function(){t.muestraErrorAsignacion=!1},2500)},t.empleadoAsignado=0,t.removerEmpleadoOficina=function(e){t.empleadoAsignado=e},t.cancelaRemover=function(){t.empleadoAsignado=0},t.eliminaEmpleadoOficina=function(e,a){s.post(baseurl+"oficinas/deleteasignacion",{id_sg_personal:e}).then(function(e){e.data.status&&(t.requestDetails(a),t.empleadoAsignado=0)})},t.btnActualizaOficina="Actualizar",t.updateOficina=function(){var e=a.OnSubmitForm({form:"#frm-create-oficina",css:".required",route:baseurl+"oficinas/update",fields:"",clear:!1});if(1==e)return!1;t.btnActualizaOficina="Actualizando ...",e.then(function(e){e.data.status&&(t.oficinaMessage=e.data.message,t.recordCreated=!0,t.readOficinas()),t.btnActualizaOficina="Actualizar"})},t.noMostrarOficinas=!1,t.detalleOficinas=[],t.loadDetalleOficinas=!1,t.enableSearch=!1,t.showDetallesOficinas=function(){t.detalleOficinas=[],t.noMostrarOficinas=!0,t.loadDetalleOficinas=!0,s.post(baseurl+"oficinas/resumenempleadosoficina",{idUser:uid}).then(function(e){e.data.status?t.detalleOficinas=e.data.rows:t.detalleOficinas=[],t.loadDetalleOficinas=!1})},t.closeDetalleOficinas=function(){t.noMostrarOficinas=!1},t.enableSearchOption=function(){t.enableSearch=!0},t.closeSearchOption=function(){t.enableSearch=!1}}]);